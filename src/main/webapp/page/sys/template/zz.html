<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>#(model)</title>
<script src="/layuiadmin/main.js"></script>
<script src="/layuiadmin/vxe-render/index.js" type="module"></script>
<style type="text/css">
</style>
</head>
<body>
	<div id="app" style="background-color: #F2F2F2">
		<el-container>
	    	<el-main>
	  			<el-card class="box-card">
	  				<div ref="banner">
	  					<el-row>
		  					<el-form :inline="true" size="mini"class="demo-form-inline">
							  <el-form-item v-for="(item,index) in parent_columns" v-if="item.is_query" :label="item.cn">
							    <el-input v-if="item.type == 'input'" v-model="queryForm[item.en]"></el-input>
							    <el-select v-if="item.type=='select' || item.type=='radio'" v-model="queryForm[item.en]" filterable placeholder="请选择">
								    <el-option
								      label="全部"
								      value=""
								      selected>
								    </el-option>
								    <el-option
								      v-for="selectItem in parent_selectList[index]"
								      :key="selectItem.id"
								      :label="selectItem.label"
								      :value="selectItem.value">
								    </el-option>
								</el-select>
								<el-date-picker
									v-if="item.type=='date'"
							        v-model="queryForm[item.en]"
							        type="daterange"
							        value-format="yyyy-MM-dd"
							        range-separator="至"
							        start-placeholder="开始日期"
							        end-placeholder="结束日期">
							    </el-date-picker>
							    <el-date-picker
									v-if="item.type=='datetime'"
							        v-model="queryForm[item.en]"
							        type="datetimerange"
							        value-format="yyyy-MM-dd HH:mm:ss"
							        range-separator="至"
							        start-placeholder="开始时间"
							        end-placeholder="结束时间">
							    </el-date-picker>
							  </el-form-item>
							  <el-form-item>
							    <el-button type="primary" @click="query">查询</el-button>
							  </el-form-item>
							</el-form>
						</el-row>
					</div>
					<div :style="'height:'+split_height+'px'">
				        <Split v-model="split" mode="vertical" on-moving="split_change">
				            <div slot="top" class="demo-split-pane">
				                <el-row>
					  			  <template>
								    <vxe-grid :data="parent_data"
								    @current-change="parent_change" 
								    highlight-current-row 
								    :export-config="{remote:true,exportMethod:this.parent_exportDataEvent}"
								    ref="xTable" :border="true" stripe size="mini" :height="parent_height"
								    :toolbar="tableToolbar"
								    resizable
								    highlight-hover-row
			          				highlight-current-row
								    :edit-config="{trigger: 'dblclick', mode: 'row'}"
								    :checkbox-config="{labelField: '', highlight: true, range: true,change:'checkEvent'}"
								    @checkbox-change="checkEvent"
								    @checkbox-all="checkEvent"
								    @checkbox-range="checkEvent"
								    :pager-config="p_tablePage"
								    @page-change="handleCurrentChange"
								    @edit-closed="parentEditClosedEvent" style="width: 100%">
								    <template v-slot:toolbar_buttons>
							            <el-button v-if="p_data_object.is_add" type="primary" size="mini" @click="parentAddInit" style="margin-left:10px">新增</el-button>
							            <el-button v-for="item in p_headButtons" v-if="item.is_show&&headButtonAuth(item)" size="mini" :type="item.color" :icon="item.icon" @click="item.type==1?headButtonConfirmClick(item):headButtonComboboxClick(item)">{{item.name}}</el-button>
							          </template>
							          <vxe-table-column type="checkbox" title="" width="60"></vxe-table-column>
								      <vxe-table-column v-if="item.is_show" v-for="(item,index) in parent_columns" :key="item.id"
								      	:field="item.en"
								      	:title="item.cn"
								      	:width="item.width"
								      	:sortable="item.is_order"
								      	:align="item.align"
						      			header-align="center"
								      	show-overflow
								      	show-header-overflow
								      	v-bind="item.type!='file'?(item.is_update&&p_data_object.is_update?
									      	(item.type=='input'?{'edit-render':{name: 'EditDownTextarea'}}:
									      	 item.type=='select'||item.type=='radio'?{'edit-render':{name: '$select', options: parent_selectList[index], optionProps: {value: 'value', label: 'label'}}}:
									      	 item.type=='switch'?{'cell-render':{name: '$switch',events:{change:parentEditClosedEvent}}}:
									      	 item.type=='date'?{'edit-render':{name: '$input', props: {type: 'date'}}}:
									      	 item.type=='datetime'?{'edit-render':{name: '$input', props: {type: 'datetime'}}}:''):
									      	 
									      	 item.formatter?{'formatter':['format',item.formatter],'type':'html'}:
											 item.type=='select'||item.type=='radio'?{'cell-render':{name:'cell-select',options: parent_selectList[index]}}:
											 item.type=='switch'?{'cell-render':{name:'cell-switch'}}:'')
											 
											 :item.is_update&&p_data_object.is_update?{'cell-render':{name: '$button',props:{status:'primary',size:'small',content:'查看'},events:{click:parent_fileEdit}}}:
											 {'cell-render':{name: '$button',props:{status:'primary',size:'small',content:'查看'},events:{click:parent_fileScan}}}">
								      </vxe-table-column>
								      <vxe-table-column
									      title="操作"
									      show-overflow
								      	  show-header-overflow
									      :width="p_data_object.handle_width"
									      v-if="p_data_object.is_handle"
									      fixed="right">
									      <template slot-scope="scope">
									      	<vxe-button v-if="s_data_object.is_add" status="primary" @click="sonAddInit(scope.row)">新增子数据</vxe-button>
									      	<el-button v-for="item in p_lineButtons" v-if="item.is_show&&lineButtonAuth(item,scope.row)" size="mini" :type="item.color" :icon="item.icon" @click="item.type==1?lineButtonConfirmClick(scope.row,item):item.type==2?lineButtonComboboxClick(scope.row,item):lineButtonDialogClick(scope.row,item)">{{item.name}}</el-button>
									        <vxe-button status="danger" v-if="p_data_object.is_delete" icon="el-icon-delete" @click="del(scope.row,'#(menu.data_object_id)')" circle></vxe-button>
									      </template>
									  </vxe-table-column>
								    </vxe-grid>
								  </template>
								</el-row>
				            </div>
				            <div slot="bottom" class="demo-split-pane">
				                <el-row>
					  			  <template>
								    <vxe-grid :data="son_data" ref="yTable" :border="true" stripe size="mini" :height="son_height"
								    :export-config="{remote:true,exportMethod:this.son_exportDataEvent}"
								    :toolbar="tableToolbar"
								    highlight-hover-row
			          				highlight-current-row
								    :edit-config="{trigger: 'dblclick', mode: 'row'}"
								    @edit-closed="sonEditClosedEvent" style="width: 100%"
								    :checkbox-config="{labelField: '', highlight: true, range: true,change:'son_checkEvent'}"
								    @checkbox-change="son_checkEvent"
								    @checkbox-all="son_checkEvent"
								    @checkbox-range="son_checkEvent">
								    <template v-slot:toolbar_buttons>
							            <el-button style="margin-left:10px" v-for="item in s_headButtons" v-if="item.is_show&&headButtonAuth(item)" size="mini" :type="item.color" :icon="item.icon" @click="item.type==1?son_headButtonConfirmClick(item):son_headButtonComboboxClick(item)">{{item.name}}</el-button>
							          </template>
							          <vxe-table-column type="checkbox" title="" width="60"></vxe-table-column>
								      <vxe-table-column v-if="item.is_show" v-for="(item,index) in son_columns" :key="item.id"
								      	:field="item.en" 
								      	:title="item.cn"
								      	:width="item.width"
								      	:align="item.align"
						      			header-align="center"
								      	show-overflow
								      	v-bind="item.type!='file'?(item.is_update&&s_data_object.is_update?
									      	(item.type=='input'?{'edit-render':{name: 'EditDownTextarea'}}:
									      	 item.type=='select'||item.type=='radio'?{'edit-render':{name: '$select', options: son_selectList[index], optionProps: {value: 'value', label: 'label'}}}:
									      	 item.type=='switch'?{'cell-render':{name: '$switch',events:{change:parentEditClosedEvent}}}:
									      	 item.type=='date'?{'edit-render':{name: '$input', props: {type: 'date'}}}:
									      	 item.type=='datetime'?{'edit-render':{name: '$input', props: {type: 'datetime'}}}:''):
									      	 
									      	 item.formatter?{'formatter':['format',item.formatter],'type':'html'}:
											 item.type=='select'||item.type=='radio'?{'cell-render':{name:'cell-select',options: son_selectList[index]}}:
											 item.type=='switch'?{'cell-render':{name:'cell-switch'}}:'')
											 
											 :item.is_update&&s_data_object.is_update?{'cell-render':{name: '$button',props:{status:'primary',size:'small',content:'查看'},events:{click:son_fileEdit}}}:
											 {'cell-render':{name: '$button',props:{status:'primary',size:'small',content:'查看'},events:{click:son_fileScan}}}">
								      </vxe-table-column>
								      <vxe-table-column
									      title="操作"
									      show-overflow
									      :width="s_data_object.handle_width"
									      v-if="s_data_object.is_handle"
									      show-overflow
								      	  show-header-overflow
									      fixed="right">
									      <template slot-scope="scope">
									      	<el-button v-for="item in s_lineButtons" size="mini" :type="item.color" :icon="item.icon" @click="item.type==1?lineButtonConfirmClick(scope.row,item):item.type==2?lineButtonComboboxClick(scope.row,item):lineButtonDialogClick(scope.row,item)">{{item.name}}</el-button>
									        <vxe-button status="danger" v-if="s_data_object.is_delete" icon="el-icon-delete" @click="del(scope.row,'#(menu.son_data_object_id)')" circle></vxe-button>
									      </template>
									  </vxe-table-column>
								    </vxe-grid>
								  </template>
								</el-row>
				            </div>
				        </Split>
				    </div>
				</el-card>
				
	  			<!-- 主表新增dialog -->
	  			<el-dialog title="新增" :before-close="handleClose" :visible.sync="parentDialogVisible" :with-header="true">
				  <el-row :gutter="4">
					  <el-form :rules="parent_rules" ref="parent_form" :model="form" label-width="80px" size="mini">
					    <el-col :span="item.type=='radio'?24:12" v-for="(item,index) in parent_columns">
					  		<el-form-item v-if="item.is_add" :label="item.cn" :prop="item.en" :label-width="formLabelWidth">
						      <el-input v-if="item.type == 'input'" v-model="form[item.en]"></el-input>
						      <el-select v-if="item.type=='select'" v-model="form[item.en]" filterable placeholder="请选择" style="width:100%">
							    <el-option
							      v-for="selectItem in parent_selectList[index]"
							      :key="selectItem.id"
							      :label="selectItem.label"
							      :value="selectItem.value">
							    </el-option>
							  </el-select>
							  <el-radio-group v-if="item.type=='radio'" v-model="form[item.en]">
							    <el-radio v-for="selectItem in parent_selectList[index]" :label="selectItem.value">{{selectItem.label}}</el-radio>
							  </el-radio-group>
							  <el-switch
							  	  v-if="item.type=='switch'"
								  v-model="form[item.en]"
								  active-color="#13ce66"
								  inactive-color="#ff4949">
							  </el-switch>
							  <el-date-picker
									v-if="item.type=='date'"
							        v-model="form[item.en]"
							        type="date"
							        value-format="yyyy-MM-dd"
							        style="width:100%"
							        placeholder="选择日期">
							  </el-date-picker>
							  <el-date-picker
									v-if="item.type=='datetime'"
							        v-model="form[item.en]"
							        type="datetime"
							        value-format="yyyy-MM-dd HH:mm:ss"
							        style="width:100%"
							        placeholder="选择日期">
							  </el-date-picker>
						      <el-upload
						      	  v-if="item.type=='file'"
								  class="upload-demo"
								  ref="upload"
								  action="/common/upload"
								  :data="{column:item.en}"
								  :accept="item.type_config.split('|')[2]"
								  :multiple="false"
								  :on-remove="beforeRemove"
								  :on-success="handleSuccess"
								  :on-exceed="handleExceed"
								  :limit="parseInt(item.type_config.split('|')[1])"
								  :file-list="fileList"
								  :auto-upload="true">
								  <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
								  <!-- <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button> -->
								  <div slot="tip" class="el-upload__tip">只能上传{{item.type_config.split('|')[2]}}文件</div>
							  </el-upload>
						    </el-form-item>
						  </el-col>
					  </el-form>
				  </el-row>
				  <span slot="footer" class="dialog-footer">
				    <el-button @click="parentDialogVisible = false">取 消</el-button>
				    <el-button type="primary" @click="onSubmit('parent_form')">确 定</el-button>
				  </span>
				</el-dialog>
				<!-- 主表新增dialog -->
				
				<!-- 子表新增dialog -->
				<el-dialog title="新增子数据" :before-close="handleClose" :visible.sync="sonDialogVisible" :with-header="true">
				  <el-row :gutter="4">
					  <el-form :rules="son_rules" ref="sonForm" :model="form" label-width="80px" size="mini">
					  	<el-col :span="item.type=='radio'?24:12" v-for="(item,index) in son_columns">
					  		<el-form-item v-if="item.is_add" :label="item.cn" :prop="item.en" :label-width="formLabelWidth">
						      <el-input v-if="item.type == 'input'" v-model="form[item.en]"></el-input>
						      <el-select v-if="item.type=='select'" v-model="form[item.en]" filterable placeholder="请选择">
							    <el-option
							      v-for="selectItem in son_selectList[index]"
							      :key="selectItem.id"
							      :label="selectItem.label"
							      :value="selectItem.value">
							    </el-option>
							  </el-select>
							  <el-radio-group v-if="item.type=='radio'" v-model="form[item.en]">
							    <el-radio v-for="selectItem in son_selectList[index]" :label="selectItem.value">{{selectItem.label}}</el-radio>
							  </el-radio-group>
							  <el-switch
							  	  v-if="item.type=='switch'"
								  v-model="form[item.en]"
								  active-color="#13ce66"
								  inactive-color="#ff4949">
							  </el-switch>
							  <el-date-picker
									v-if="item.type=='date'"
							        v-model="form[item.en]"
							        type="date"
							        value-format="yyyy-MM-dd"
							        placeholder="选择日期">
							  </el-date-picker>
							  <el-date-picker
									v-if="item.type=='datetime'"
							        v-model="form[item.en]"
							        type="datetime"
							        value-format="yyyy-MM-dd HH:mm:ss"
							        placeholder="选择日期">
							  </el-date-picker>
						      <el-upload
						      	  v-if="item.type=='file'"
								  class="upload-demo"
								  ref="upload"
								  action="/common/upload"
								  :data="{column:item.en}"
								  :accept="item.type_config.split('|')[2]"
								  :multiple="false"
								  :on-remove="beforeRemove"
								  :on-success="handleSuccess"
								  :on-exceed="handleExceed"
								  :limit="parseInt(item.type_config.split('|')[1])"
								  :file-list="fileList"
								  :auto-upload="true">
								  <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
								  <!-- <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button> -->
								  <div slot="tip" class="el-upload__tip">只能上传{{item.type_config.split('|')[2]}}文件</div>
							  </el-upload>
						    </el-form-item>
						  </el-col>
					  </el-form>
					</el-row>
				  <span slot="footer" class="dialog-footer">
				    <el-button @click="sonDialogVisible = false">取 消</el-button>
				    <el-button type="primary" @click="onSubmit('sonForm')">确 定</el-button>
				  </span>
				</el-dialog>
				<!-- 子表新增dialog -->
				
				<!-- 文件列表dialog -->
				<el-dialog title="文件列表" :visible.sync="fileDialogVisible" :with-header="true" width="300px">
					<template v-for="(item,index) in inFileList">
						<el-row style="margin-top:10px" justify="space-between">
							<el-col :span="20">
								<a :href="domin_url+item.url" target="_blank">{{item.name}}</a>
							</el-col>
							<el-col :span="4" v-if="file_edit" style="text-align:right">
								<a style="cursor:pointer" @click="delFile(item.id,index)">x</a>
							</el-col>
						</el-row>
					</template>
						<el-row style="margin-top:20px">
							<el-upload
								  class="upload-demo"
								  ref="uploadUpdate"
								  action="/common/upload"
								  :multiple="false"
								  :on-remove="beforeRemove"
								  :on-success="handleSuccess"
								  :on-exceed="handleExceed"
								  :file-list="fileList"
								  :auto-upload="true">
								  <el-button v-if="file_edit" slot="trigger" size="small">上传</el-button>
								  <el-button v-if="file_edit" type="primary" size="small" @click="confirmUpload()">保存</el-button>
								  <!-- <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button> -->
							  </el-upload>
						</el-row>
				</el-dialog>
				<!-- 文件列表dialog -->
				<el-dialog :title="buttonDialogTitle" :visible.sync="buttonDialog" :with-header="true" :width="buttonDialogWidth">
					<div :style="{'height':dialogHeight}">
					<iframe ref="dialogFrame" :key="Math.random()" :src="buttonDialogSrc" frameborder="0" width="100%" height="100%"></iframe>
					</div>
				</el-dialog>
	  		</el-main>
		</el-container>
	</div>
<script src="/layuiadmin/ray/zz.js"></script>
<script>
var app = new Vue({
	el: '#app',
	data: buildData({
	 
	}),
	created: function () {
		this.getMenuInfo();
	},
	watch:buildWatch({
	
	}),
	methods: buildMethods({
	
	}),
})
</script>

</body>
</html>