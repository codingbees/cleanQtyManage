<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>#(model)</title>
<script src="/layuiadmin/main.js"></script>
<script src="/layuiadmin/vxe-render/index.js" type="module"></script>
</head>
<body>
	<div id="app">
		<el-container>
	    	<el-main>
	  			<el-card class="box-card">
	  				<div ref="banner">
	  					<el-row>
		  					<el-form ref="queryForm" :inline="true" size="mini" :model="queryForm" class="demo-form-inline">
							  <el-form-item v-for="(item,index) in columns" v-if="item.is_query" :key="index" :label="item.cn" :prop="item.en">
							    <el-input v-if="item.type == 'input'" v-model.lazy="queryForm[item.en]"></el-input>
							    <el-select v-if="item.type=='select' || item.type=='radio'" v-model="queryForm[item.en]" filterable placeholder="请选择">
								    <el-option
								      label="全部"
								      value=""
								      selected>
								    </el-option>
								    <el-option
								      v-for="selectItem in selectList[index]"
								      :key="selectItem.id"
								      :label="selectItem.label"
								      :value="selectItem.value">
								    </el-option>
								</el-select>
								<el-date-picker
									v-if="item.type=='date'"
									v-model="queryForm[item.en]"
							        type="daterange"
							        value-format="yyyy-MM-dd"
							        range-separator="至"
							        start-placeholder="开始日期"
							        end-placeholder="结束日期">
							    </el-date-picker>
							    <el-date-picker
									v-if="item.type=='datetime'"
									v-model="queryForm[item.en]"
							        type="datetimerange"
							        value-format="yyyy-MM-dd HH:mm:ss"
							        range-separator="至"
							        start-placeholder="开始时间"
							        end-placeholder="结束时间">
							    </el-date-picker>
							  </el-form-item>
							  <el-form-item v-if="is_query" collapse-node>
							    <el-button type="primary" @click="query">查询</el-button>
							  </el-form-item>
							</el-form>
						</el-row>
					</div>
					<el-row>
			  			<template>
						    <vxe-grid ref="table" :data="datas" :border="true"
						    :export-config="{remote:true,exportMethod:this.exportDataEvent}"
						    stripe size="mini" :height="tableHeight"
						    :toolbar="tableToolbar"
						    resizable
						    highlight-hover-row
          					highlight-current-row
						    :edit-config="{trigger: 'dblclick', mode: 'cell'}"
						    :checkbox-config="{labelField: '', highlight: true, range: true,change:'checkEvent'}"
						    @checkbox-change="checkEvent"
						    @checkbox-all="checkEvent"
						    @checkbox-range="checkEvent"
						    :pager-config="tablePage"
						    @page-change="handleCurrentChange"
						    @edit-closed="editClosedEvent" style="width: 100%">
						    <template v-slot:toolbar_buttons>
					            <el-button v-if="data_object.is_add" type="primary" size="mini" @click="addInit" style="margin-left:10px">新增</el-button>
					            <el-button v-for="item in headButtons" :key="item.id" v-if="item.is_show&&headButtonAuth(item)" size="mini" :type="item.color" :icon="item.icon" @click="item.type==1?headButtonConfirmClick(item):headButtonComboboxClick(item)">{{item.name}}</el-button>
					          </template>
				          	  <vxe-table-column type="checkbox" title="" width="60"></vxe-table-column>
				          	  <!-- (item.type=='input'?{'formatter':['myAmount',item.config],'type':'html'}: -->
						      <vxe-table-column v-if="item.is_show" v-for="(item,index) in columns" :key="item.id"
						      	:field="item.en" 
						      	:title="item.cn"
						      	:width="item.width"
						      	:sortable="item.is_order"
						      	show-overflow
						      	show-header-overflow
						      	v-bind="item.type!='file'?(item.is_update&&data_object.is_update?
						      	(item.type=='input'?{'edit-render':{name: 'input'}}:
						      	 item.type=='select'||item.type=='radio'?{'edit-render':{name: '$select', options: selectList[index], optionProps: {value: 'value', label: 'label'}}}:
						      	 item.type=='switch'?{'cell-render':{name: '$switch',events:{change:editClosedEvent}}}:
						      	 item.type=='date'?{'edit-render':{name: '$input', props: {type: 'date'}}}:
						      	 item.type=='datetime'?{'edit-render':{name: '$input', props: {type: 'datetime'}}}:''):
						      	 
								 item.type=='select'||item.type=='radio'?{'cell-render':{name:'cell-select',options: selectList[index]}}:
								 item.type=='switch'?{'cell-render':{name:'cell-switch'}}:'')
								 
								 :item.is_update&&data_object.is_update?{'cell-render':{name: '$button',props:{status:'primary',size:'small',content:'查看'},events:{click:fileEdit}}}:
								 {'cell-render':{name: '$button',props:{status:'primary',size:'small',content:'查看'},events:{click:fileScan}}}">
						      </vxe-table-column>
						      <vxe-table-column
							      title="操作"
							      :width="data_object.handle_width"
							      v-if="data_object.is_handle"
							      show-overflow
						      	  show-header-overflow
							      fixed="right">
							      <template slot-scope="scope">
							      	<el-button v-for="item in lineButtons" :key="item.id" v-if="item.is_show&&lineButtonAuth(item,scope.row)" size="mini" :type="item.color" :icon="item.icon" @click="item.type==1?lineButtonConfirmClick(scope.row,item):item.type==2?lineButtonComboboxClick(scope.row,item):lineButtonDialogClick(scope.row,item)">{{item.name}}</el-button>
							        <el-button type="danger" v-if="data_object.is_delete" size="mini" icon="el-icon-delete" @click="del(scope.row)" circle></el-button>
							      </template>
							  </vxe-table-column>
						    </vxe-grid>
						  </template>
					</el-row>
					<el-dialog :title="dialogTitle" :before-close="handleClose" :visible.sync="dialogVisible" :with-header="true">
					  <el-row :gutter="4">
						  <el-form :rules="rules" ref="form" size="small" :model="form" label-width="100px">
					  		<el-col :span="item.type=='radio'?24:12" v-for="(item,index) in columns" :key="item.id">
						  		<el-form-item v-if="item.is_add" :label="item.cn" :prop="item.en" :label-width="formLabelWidth">
							      <el-input v-if="item.type == 'input'" v-model="form[item.en]"></el-input>
							      <el-select v-if="item.type=='select'" v-model="form[item.en]" style="width: 100%;" filterable placeholder="请选择">
								    <el-option
								      v-for="selectItem in selectList[index]"
								      :key="selectItem.id"
								      :label="selectItem.label"
								      :value="selectItem.value">
								    </el-option>
								  </el-select>
								  <el-radio-group v-if="item.type=='radio'" v-model="form[item.en]">
								    <el-radio v-for="selectItem in selectList[index]" :key="selectItem.id" :label="selectItem.value">{{selectItem.label}}</el-radio>
								  </el-radio-group>
								  <el-checkbox-group v-if="item.type=='checkbox'" v-model="form[item.en]">
								    <el-checkbox v-for="selectItem in selectList[index]" :key="selectItem.id" :label="selectItem.value">{{selectItem.label}}</el-checkbox>
								  </el-checkbox-group>
								  <el-switch
								  	  v-if="item.type=='switch'"
									  v-model="form[item.en]"
									  active-color="#13ce66"
									  inactive-color="#ff4949">
								  </el-switch>
								  <el-date-picker
										v-if="item.type=='date'"
								        v-model="form[item.en]"
								        type="date"
								        value-format="yyyy-MM-dd"
								        style="width: 100%;"
								        placeholder="选择日期">
								  </el-date-picker>
								  <el-date-picker
										v-if="item.type=='datetime'"
								        v-model="form[item.en]"
								        type="datetime"
								        value-format="yyyy-MM-dd HH:mm:ss"
								        style="width: 100%;"
								        placeholder="选择日期">
								  </el-date-picker>
							      <el-upload
							      	  v-if="item.type=='file'"
									  class="upload-demo"
									  ref="upload"
									  action="/common/upload"
									  :data="{column:item.en}"
									  :accept="item.formatter.split('|')[2]"
									  :multiple="false"
									  :on-remove="beforeRemove"
									  :on-success="handleSuccess"
									  :on-exceed="handleExceed"
									  :limit="parseInt(item.formatter.split('|')[1])"
									  :file-list="fileList"
									  :auto-upload="true">
									  <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
									  <!-- <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button> -->
									  <div slot="tip" class="el-upload__tip">只能上传{{item.formatter.split('|')[2]}}文件</div>
								  </el-upload>
							    </el-form-item>
							  </el-col>
						  </el-form>
						</el-row>
					  <span slot="footer" class="dialog-footer">
					    <el-button @click="dialogVisible = false">取 消</el-button>
					    <el-button type="primary" @click="onSubmit('form')">确 定</el-button>
					  </span>
					</el-dialog>
					<el-dialog title="文件列表" :visible.sync="fileDialogVisible" :with-header="true" width="300px">
						<template v-for="(item,index) in inFileList">
							<el-row style="margin-top:10px" justify="space-between">
								<el-col :span="20">
									<a :href="'#(domin_url)'+item.url" target="_blank">{{item.name}}</a>
								</el-col>
								<el-col v-if="file_edit" :span="4" style="text-align:right">
									<a style="cursor:pointer" @click="delFile(item.id,index)">x</a>
								</el-col>
							</el-row>
						</template>
							<el-row style="margin-top:20px">
								<el-upload
									  class="upload-demo"
									  ref="uploadUpdate"
									  action="/common/upload"
									  :multiple="false"
									  :on-remove="beforeRemove"
									  :on-success="handleSuccess"
									  :on-exceed="handleExceed"
									  :file-list="fileList"
									  :auto-upload="true">
									  <el-button v-if="file_edit" slot="trigger" size="small">上传</el-button>
									  <el-button v-if="file_edit" type="primary" size="small" @click="confirmUpload()">保存</el-button>
								  </el-upload>
								  
							</el-row>
					</el-dialog>
					<el-dialog :title="buttonDialogTitle" :visible.sync="buttonDialog" :with-header="true" :width="buttonDialogWidth">
						<div :style="{'height':dialogHeight}">
						<iframe ref="dialogFrame" :key="Math.random()" :src="buttonDialogSrc" frameborder="0" width="100%" height="100%"></iframe>
						</div>
					</el-dialog>
	  			</el-card>
	  		</el-main>
		</el-container>
	</div>
<script>
var app = new Vue({
  el: '#app',
  data: {
	  data_object:{},
	  user_roles:'#(session.user_roles)',
	  datas:[],
	  columns:[],
	  form:{},
	  is_query:false,
	  queryForm:{},
	  fileList:[],
	  inFileList:[],
	  dialogVisible: false,
	  fileDialogVisible:false,
	  dialogTitle:'',
      formLabelWidth: '120px',
      fullHeight: document.documentElement.clientHeight,
      tableHeight:0,
      tablePage:{
          currentPage: 1,
          pageSize: 20,
          total: 0,
          pageSizes: [20, 50, 100, 200, 500],
          layouts: ['Sizes', 'PrevJump', 'PrevPage', 'Number', 'NextPage', 'NextJump', 'FullJump', 'Total'],
   		  perfect: true
      },
      exportConfig: {
          remote: true,
          exportMethod: this.exportDataEvent
      },
      selectRow:{},
      select_rows:[],
      rules:{},
      headButtons:[],
      lineButtons:[],
      checkList:[],
      tableToolbar: {
          slots: {
            buttons: 'toolbar_buttons'
          },
          refresh: true,
          export: true,
          print: true,
          zoom: true,
          custom: true,
          perfect:true
      },
      buttonDialog:false,
      buttonDialogTitle:'',
      buttonDialogWidth:'',
      buttonDialogSrc:'',
	  dialogRow:{},
	  dialogHeight:'',
	  file_edit:false,
  },
  created: function () {
	  this.getColumns();
	  test('#(object_id)');
  },
  watch:{
	  fullHeight:function(){
		  this.tableHeight=this.fullHeight-this.$refs.banner.offsetHeight-85;
	  },
	  columns:function(){
		  this.$nextTick(()=>{ // 页面渲染完成后的回调
			  this.getData();
		      this.tableHeight=this.fullHeight-this.$refs.banner.offsetHeight-85;
		  });
	  }
  },
  methods: {
	  /* cell_select({ cellValue, row, column }) {
		  console.log(cellValue);
		  console.log(row);
		  console.log(column);
             return 10;
         }, */
	  /* formChange(value,en,type){
		  var a = value;
		if(type=='checkbox'){
			value = "";
			for(var i=0;i<a.length;i++){
				value += a[i]+",";
			}
			value = value.substring(0,value.length-1);
		}
		this.$set(this.formData, en, value);
	  }, 
	  queryFormChange(value,en){
		this.$set(this.queryForm, en, value);
	  }, */
	  getColumns: function (event) {
		  var _this = this;
		  axios({
	    		method:"post",
	    		url:"/single/getColumns",
	    		params:{object_id:'#(object_id)'}
    		}).then((res)=>{
		    	if(res.status==200){
			    	_this.data_object = res.data.data_object;
		    		_this.columns = res.data.list;
		    		_this.is_query = res.data.is_query;
		    		_this.selectList = res.data.selectMap;
		    		_this.rules = res.data.validator;
		    		_this.headButtons = res.data.headButtons;
		    		_this.lineButtons = res.data.lineButtons;
			  	}else{
			  		this.$message.error('网络请求失败');
			  	}
    		})  
	  },
	  getData: function (event) {
		  var _this = this;
		  axios({
	    		method:"post",
	    		url:"/single/getData",
	    		params:{object_id:'#(object_id)',
	    			parent_id:'#(parent_id)',
	    			parent_id_field:'#(parent_id_field)',currentPage:_this.tablePage.currentPage,pageSize:_this.tablePage.pageSize}
    		}).then((res)=>{
		    	if(res.status==200){
			    	if(res.data.state=="fail"){
			    		this.$message.error(res.data.msg);
				    }else{
				    	_this.datas = res.data.list;
				    	_this.tablePage.total = res.data.totalResult;
					}
			  	}else{
			  		this.$message.error('网络请求失败');
			  	}
    		})
	  },
	  handleCurrentChange:function({ currentPage, pageSize }){
		  this.tablePage.currentPage = currentPage
          this.tablePage.pageSize = pageSize
          this.getData();
	  },
	  query(){
		  var _this = this;
		  axios({
	    		method:"post",
	    		url:"/single/getData",
	    		params:{object_id:'#(object_id)',
	    			parent_id:'#(parent_id)',
	    			parent_id_field:'#(parent_id_field)',queryForm:_this.queryForm,currentPage:_this.tablePage.currentPage,pageSize:_this.tablePage.pageSize}
    		}).then((res)=>{
		    	if(res.status==200){
		    		_this.datas = res.data.list;
		    		_this.tablePage.total = res.data.totalResult;
			  	}else{
			  		this.$message.error('网络请求失败');
			  	}
    		})
	  },
	  addInit:function(){
    	this.dialogTitle='新增';
    	this.form = {};
    	this.fileList = [];
    	this.dialogVisible = true;
	  },
      onSubmit:function(formName){
    	  var _this = this;
    	  this.$refs[formName].validate((valid) => {
              if (valid) {
            	  axios({
	  		    		method:"post",
	  		    		url:"/single/new_",
	  		    		params:{form:_this.form,fileList:_this.fileList,object_id:'#(object_id)',parent_id:'#(parent_id)',
	  		    			parent_id_field:'#(parent_id_field)'}
	  	    		}).then((res)=>{
	  			    	if(res.status==200){
	  			    		if(res.data.state=="ok"){
	  				    		_this.$message({
	  			    		          message: res.data.msg,
	  			    		          type: 'success'
	  			    		        });
	  				    		_this.dialogVisible = false;
	  				    		_this.getData();
	  					    }else{
	  					    	this.$message.error(res.data.msg);
	  						}
	  				  	}else{
	  				  		this.$message.error('网络请求失败');
	  				  	}
	  	    		})
              } else {
            	  console.log('error submit!!');
                  return false;
              }
            });
      },
      //cell编辑
	  editClosedEvent ({ row, column }, event) {
		  var _this = this;
		  axios({
	    		method:"post",
	    		url:"/single/edit",
	    		params:{row:row,object_id:'#(object_id)',column:column.property}
    		}).then((res)=>{
		    	if(res.status==200){
			    	if(res.data.state=="ok"){
			    		_this.$message({
		    		          message: res.data.msg,
		    		          type: 'success'
		    		        });
				    }else{
				    	this.$message.error(res.data.error.message);
					}
			  	}else{
			  		this.$message.error('网络请求失败');
			  	}
    		})
         },
      del:function(row){
    	var _this = this;
    	this.$confirm('确定要删除吗？', '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(() => {
        	  axios({
		    		method:"post",
		    		url:"/single/del",
		    		params:{id:row.id,object_id:'#(object_id)'}
	    		}).then((res)=>{
			    	if(res.status==200){
			    		if(res.data.state=="ok"){
				    		_this.$message({
			    		          message: res.data.msg,
			    		          type: 'success'
			    		        });
				    		_this.$refs.table.remove(row);
					    }else{
					    	this.$message.error(res.data.msg);
						}
				  	}else{
				  		this.$message.error('网络请求失败');
				  	}
	    		})
          }).catch(() => {
            this.$message({
              type: 'info',
              message: '已取消删除'
            });          
          });
      },
      handleClose(done) {
        this.$confirm('确认关闭？')
          .then(_ => {
            done();
          })
          .catch(_ => {});
         },
         beforeRemove(file, fileList) {
      		this.fileList = fileList;
      },
      handleSuccess(res,file,fileList){
        	this.fileList = fileList;
      },
      handleExceed(file, fileList){
    	  this.$message({
              type: 'error',
              message: '超出文件个数限制'
          });
      },
      exportDataEvent:function({ options }) {
    	  var _this = this;
              const body = {
                filename: options.filename,
                sheetName: options.sheetName,
                isHeader: options.isHeader,
                original: options.original,
                mode: options.mode,
                ids: options.mode === 'selected' ? options.data.map(item => item.id) : [],
                fields: options.columns.map(column => {
                  return {
                    field: column.property,
                    title: column.title
                  }
                })
              }
              // 开始服务端导出
			  return axios({
		    		method:"post",
		    		url:"/common/export",
		    		params:{body:body,
		    			parent_id:'#(parent_id)',
		    			parent_id_field:'#(parent_id_field)',
		    			queryForm:_this.queryForm,
		    			object_id:'#(object_id)'}
	    		}).then(res=>{
			    	if(res.status==200){
			    		location.href = '#(domin_url)'+res.data.url
				  	}else{
				  		this.$message.error('网络请求失败');
				  	}
	    		})
         },
      fileEdit({row,column}){
    	  var _this = this;
    	  _this.fileList = [];
    	  _this.selectRow = row;
    	  _this.file_column = column.property;
    	  _this.file_edit = true;
    	  axios({
	    		method:"post",
	    		url:"/common/getFileList",
	    		params:{row:row,column:_this.file_column}
    		}).then((res)=>{
		    	if(res.status==200){
			    	_this.inFileList = res.data;
			    	_this.fileDialogVisible = true;
			  	}else{
			  		this.$message.error('网络请求失败');
			  	}
    		})
	  },
	  fileScan({row,column}){
    	  var _this = this;
    	  _this.fileList = [];
    	  _this.selectRow = row;
    	  _this.file_column = column.property;
    	  _this.file_edit = false;
    	  axios({
	    		method:"post",
	    		url:"/common/getFileList",
	    		params:{row:row,column:_this.file_column}
    		}).then((res)=>{
		    	if(res.status==200){
			    	_this.inFileList = res.data;
			    	_this.fileDialogVisible = true;
			  	}else{
			  		this.$message.error('网络请求失败');
			  	}
    		})
	  },
	  delFile(id,index){
		  var _this = this;
		  _this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {
	          confirmButtonText: '确定',
	          cancelButtonText: '取消',
	          type: 'warning'
	        }).then(() => {
	        	axios({
		    		method:"post",
		    		url:"/common/delFile",
		    		params:{row:_this.selectRow,column:_this.file_column,file_id:id,object_id:'#(object_id)'}
	    		}).then((res)=>{
			    	if(res.status==200){
				    	if(res.data.state=="ok"){
				    		_this.$message({
			    		          message: res.data.msg,
			    		          type: 'success'
			    		        });
		    		        _this.inFileList.splice(index,1)
					    }else{
					    	this.$message.error(res.data.msg);
						}
				  	}else{
				  		this.$message.error('网络请求失败');
				  	}
	    		})
	        })
	  },
	  confirmUpload(){
		var _this = this;
		axios({
    		method:"post",
    		url:"/common/confirmUpload",
    		params:{row:_this.selectRow,fileList:_this.fileList,object_id:'#(object_id)',column:_this.file_column}
   		}).then((res)=>{
	    	if(res.status==200){
	    		if(res.data.state=="ok"){
		    		_this.$message({
	    		          message: res.data.msg,
	    		          type: 'success'
	    		    });
	    		    for(var i=0;i<res.data.respFileList.length;i++){
	    		    	_this.inFileList.push({
 			    		    	id:res.data.respFileList[i].id,
 				    			name: res.data.respFileList[i].name,
 				    			url:res.data.respFileList[i].url
 				    		});
 			    		}
 			    		_this.$refs.uploadUpdate.clearFiles();
			    }else{
			    	this.$message.error(res.data.msg);
				}
		  	}else{
		  		this.$message.error('网络请求失败');
		  	}
   		})
	  },
	  lineButtonConfirmClick(row,button){
		  var _this = this;
		  _this.$confirm(button.tip, '提示', {
	          confirmButtonText: '确定',
	          cancelButtonText: '取消',
	          type: 'warning'
	        }).then(() => {
	        	axios({
		    		method:"post",
		    		url:button.action,
		    		params:row
	    		}).then((res)=>{
			    	if(res.status==200){
				    	if(res.data.state=="ok"){
				    		_this.$message({
		    		          message: res.data.msg,
		    		          type: 'success'
		    		        });
					    }else{
					    	this.$message.error(res.data.msg);
						}
				  	}else{
				  		this.$message.error('网络请求失败');
				  	}
	    		})
	        })
	  },
	  lineButtonComboboxClick(row,button){
		  var _this = this;
		  this.$prompt(button.tip, '提示', {
	          confirmButtonText: '确定',
	          cancelButtonText: '取消',
	        }).then(({ value }) => {
		        row.comboValue = value;
	        	axios({
		    		method:"post",
		    		url:button.action,
		    		params:row
	    		}).then((res)=>{
			    	if(res.status==200){
				    	if(res.data.state=="ok"){
				    		_this.$message({
		    		          message: res.data.msg,
		    		          type: 'success'
		    		        });
					    }else{
					    	this.$message.error(res.data.msg);
						}
				  	}else{
				  		this.$message.error('网络请求失败');
				  	}
	    		})
	        })
	  },
	  lineButtonDialogClick(row,button){
		    var _this = this;
    		_this.buttonDialog = true;
	    	_this.buttonDialogSrc = button.dialog_src;
	    	_this.buttonDialogTitle = button.dialog_title;
	    	_this.buttonDialogWidth = button.dialog_width;
	    	_this.dialogRow = row;
	  },
	  headButtonConfirmClick(button){
		  var _this = this;
		  if(_this.select_rows.length>0){
			  _this.$confirm(button.tip, '提示', {
		          confirmButtonText: '确定',
		          cancelButtonText: '取消',
		          type: 'warning'
		        }).then(() => {
		        	axios({
			    		method:"post",
			    		url:button.action,
			    		params:{rows:_this.select_rows}
		    		}).then((res)=>{
				    	if(res.status==200){
					    	if(res.data.state=="ok"){
					    		_this.$message({
			    		          message: res.data.msg,
			    		          type: 'success'
			    		        });
						    }else{
						    	this.$message.error(res.data.msg);
							}
					  	}else{
					  		this.$message.error('网络请求失败');
					  	}
		    		})
		        })
		  }else{
			  this.$message({
		          message: '请至少选择一行数据进行操作',
		          type: 'warning'
		        });
		  }
	  },
	  headButtonComboboxClick(button){
		  var _this = this;
		  if(_this.select_rows.length>0){
			  _this.$prompt(button.tip, '提示', {
		          confirmButtonText: '确定',
		          cancelButtonText: '取消',
		        }).then(({ value }) => {
		        	axios({
			    		method:"post",
			    		url:button.action,
			    		params:{comboValue:value,rows:_this.select_rows}
		    		}).then((res)=>{
				    	if(res.status==200){
					    	if(res.data.state=="ok"){
					    		_this.$message({
			    		          message: res.data.msg,
			    		          type: 'success'
			    		        });
						    }else{
						    	this.$message.error(res.data.msg);
							}
					  	}else{
					  		this.$message.error('网络请求失败');
					  	}
		    		})
		        })
			}else{
				this.$message({
			          message: '请至少选择一行数据进行操作',
			          type: 'warning'
			        });
			}
	  },
	  checkEvent ({ checked, records }) {
		  this.select_rows = records
            },
            headButtonAuth:function(item){
                if(item.auth_role!=null){
					var roles = item.auth_role.split(",");
					for(var i=0;i<roles.length;i++){
						if(this.user_roles.indexOf(roles[i])!=-1){
							return true;
						}
					}
                }else{
					return true;
                }
               	return false;
            },
            lineButtonAuth:function(item,row){
                if(item.auth_role!=null){
					var roles = item.auth_role.split(",");
					for(var i=0;i<roles.length;i++){
						if(this.user_roles.indexOf(roles[i])!=-1){
							if(item.auth_row!=null){
								var authrow = JSON.parse(item.auth_row);
								for(var j = 0;j<authrow.length;j++){
									for(let key  in row){
								        if(key == authrow[j].field){
									        var aaa = row[key]+authrow[j].operator+authrow[j].value;
								        	if(!eval(aaa)){
												return false;
									        }
									    }
								    }
								}
							}
							return true;
						}
					}
                }else{
              	  if(item.auth_row!=null){
					var authrow = JSON.parse(item.auth_row);
					for(var j = 0;j<authrow.length;j++){
						for(let key  in row){
					        if(key == authrow[j].field){
						        var aaa = row[key]+authrow[j].operator+authrow[j].value;
					        	if(!eval(aaa)){
									return false;
						        }
						    }
					    }
					}
				}
			  return true;
                }
                return false;
            },
  }
})
</script>
</body>
</html>